<!--
  ~ Copyright 2020 Red Hat, Inc. and/or its affiliates.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<!DOCTYPE html>
<html lang="en">

<head>
  <style>
    html,
    body,
    iframe {
      margin: 0;
      border: 0;
      padding: 0;
      height: calc(100vh - 40px);
      width: 100%;
    }

    .toolbar {
      height: 30px;
    }

    .hidden {
      display: none;
    }
  </style>

  <title></title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <script src="index.js"></script>
</head>

<body>
<div class="toolbar">
  <span id="unsavedChanges" class="hidden">File contains unsaved changes.</span>
  <button id="undo">
    < Undo</button>
  <button id="redo">Redo ></button>
  <button id="download">Download</button>
  <button id="downloadSvg">Download SVG</button>
</div>
<div id="dmn-editor-container" />

<script>
  const editor = DmnEditor.open({
    container: document.getElementById("dmn-editor-container"),
    initialContent: '<dmn:definitions xmlns:dmn="http://www.omg.org/spec/DMN/20180521/MODEL/" xmlns="https://kiegroup.org/dmn/_5634AA8A-D000-4013-B5E7-143BC3166324" xmlns:feel="http://www.omg.org/spec/DMN/20180521/FEEL/" xmlns:kie="http://www.drools.org/kie/dmn/1.2" xmlns:dmndi="http://www.omg.org/spec/DMN/20180521/DMNDI/" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" xmlns:included1="https://kiegroup.org/dmn/_6CC98ABD-4724-4C4F-88C6-404539220414" id="_5BA2A03E-41E3-448B-BA0A-4C26E854BBE2" name="second" typeLanguage="http://www.omg.org/spec/DMN/20180521/FEEL/" namespace="https://kiegroup.org/dmn/_5634AA8A-D000-4013-B5E7-143BC3166324"><dmn:extensionElements/><dmn:import id="_578D1CA6-53B7-4CF7-92E1-C55563FFA56F" name="my first model" namespace="https://kiegroup.org/dmn/_6CC98ABD-4724-4C4F-88C6-404539220414" locationURI="first.dmn" importType="http://www.omg.org/spec/DMN/20180521/MODEL/"/><dmn:decision id="_79B2A8A0-C067-4264-AA0B-7F0E71E26B17" name="Decision-1"><dmn:extensionElements/><dmn:variable id="_BD5DA10C-7A7B-4461-82FA-0D5DA77BD979" name="Decision-1"/></dmn:decision><dmndi:DMNDI><dmndi:DMNDiagram id="_87BBC6D0-8CDF-4602-8456-69F68CABDC16" name="DRG"><di:extension><kie:ComponentsWidthsExtension/></di:extension><dmndi:DMNShape id="dmnshape-drg-_E6E8DE52-8B8C-4FAF-B928-3AEC1C498BA0" dmnElementRef="included1:_E6E8DE52-8B8C-4FAF-B928-3AEC1C498BA0" isCollapsed="false"><dmndi:DMNStyle><dmndi:FillColor red="255" green="255" blue="255"/><dmndi:StrokeColor red="0" green="0" blue="0"/><dmndi:FontColor red="0" green="0" blue="0"/></dmndi:DMNStyle><dc:Bounds x="626" y="298" width="226" height="72"/><dmndi:DMNLabel/></dmndi:DMNShape><dmndi:DMNShape id="dmnshape-drg-_B600347F-F3F0-4DEC-AFB3-F269D31962B8" dmnElementRef="included1:_B600347F-F3F0-4DEC-AFB3-F269D31962B8" isCollapsed="false"><dmndi:DMNStyle><dmndi:FillColor red="255" green="255" blue="255"/><dmndi:StrokeColor red="0" green="0" blue="0"/><dmndi:FontColor red="0" green="0" blue="0"/></dmndi:DMNStyle><dc:Bounds x="312" y="417" width="100" height="50"/><dmndi:DMNLabel/></dmndi:DMNShape><dmndi:DMNShape id="dmnshape-drg-_79B2A8A0-C067-4264-AA0B-7F0E71E26B17" dmnElementRef="_79B2A8A0-C067-4264-AA0B-7F0E71E26B17" isCollapsed="false"><dmndi:DMNStyle><dmndi:FillColor red="255" green="255" blue="255"/><dmndi:StrokeColor red="0" green="0" blue="0"/><dmndi:FontColor red="0" green="0" blue="0"/></dmndi:DMNStyle><dc:Bounds x="408" y="171" width="193" height="67"/><dmndi:DMNLabel/></dmndi:DMNShape></dmndi:DMNDiagram></dmndi:DMNDI></dmn:definitions>',
    readOnly: false,
    resources: new Map([
      [
        "childModel.dmn",
        {
          contentType: "text",
          content: '<dmn:definitions xmlns:dmn="http://www.omg.org/spec/DMN/20180521/MODEL/" xmlns="https://kiegroup.org/dmn/_6CC98ABD-4724-4C4F-88C6-404539220414" xmlns:feel="http://www.omg.org/spec/DMN/20180521/FEEL/" xmlns:kie="http://www.drools.org/kie/dmn/1.2" xmlns:dmndi="http://www.omg.org/spec/DMN/20180521/DMNDI/" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" id="_57FB8F24-D8CA-417A-9D61-094E673AD907" name="first" typeLanguage="http://www.omg.org/spec/DMN/20180521/FEEL/" namespace="https://kiegroup.org/dmn/_6CC98ABD-4724-4C4F-88C6-404539220414"><dmn:extensionElements/><dmn:decision id="_E6E8DE52-8B8C-4FAF-B928-3AEC1C498BA0" name="Can drink"><dmn:extensionElements/><dmn:variable id="_2CC42392-702E-4779-AAD6-6C82CF061A90" name="Can drink" typeRef="boolean"/><dmn:informationRequirement id="_B2D8CFE3-FE64-48A7-AD82-457572D9DB92"><dmn:requiredInput href="#_B600347F-F3F0-4DEC-AFB3-F269D31962B8"/></dmn:informationRequirement><dmn:decisionTable id="_FA30F740-9D8D-4E06-B6A0-765970FA329E" hitPolicy="UNIQUE" preferredOrientation="Rule-as-Row"><dmn:input id="_B0A9D508-1E1F-45C7-9042-D334EC824A17"><dmn:inputExpression id="_01856FEE-700C-418C-A80A-1394CB046EA0" typeRef="number"><dmn:text>Age</dmn:text></dmn:inputExpression></dmn:input><dmn:output id="_69D6D623-E411-40C4-B941-7C9CAD9B2218"/><dmn:annotation name="Comment"/><dmn:rule id="_D656E1F1-C0F1-4362-A0C7-415C45E465C6"><dmn:inputEntry id="_DFD014A3-5658-4000-8101-B2036DF3AE38"><dmn:text>&gt;= 18</dmn:text></dmn:inputEntry><dmn:outputEntry id="_DE578CF5-9474-4B3A-BC49-A4586719D6F6"><dmn:text>true</dmn:text></dmn:outputEntry><dmn:annotationEntry><dmn:text>Go on!!</dmn:text></dmn:annotationEntry></dmn:rule><dmn:rule id="_28EE9596-4122-4F5A-81D6-9E206AB98C87"><dmn:inputEntry id="_18442DCE-81A6-4E7F-B090-D33725BFB6E6"><dmn:text>&lt; 18</dmn:text></dmn:inputEntry><dmn:outputEntry id="_12912324-273A-4314-8C8C-AB3232A0114F"><dmn:text>false</dmn:text></dmn:outputEntry><dmn:annotationEntry><dmn:text/></dmn:annotationEntry></dmn:rule></dmn:decisionTable></dmn:decision><dmn:inputData id="_B600347F-F3F0-4DEC-AFB3-F269D31962B8" name="Age"><dmn:extensionElements/><dmn:variable id="_2448C371-F77A-4211-BFDE-50BED15FC10E" name="Age" typeRef="number"/></dmn:inputData><dmndi:DMNDI><dmndi:DMNDiagram id="_2C762C55-9A84-4172-84BD-14F412094514" name="DRG"><di:extension><kie:ComponentsWidthsExtension><kie:ComponentWidths dmnElementRef="_FA30F740-9D8D-4E06-B6A0-765970FA329E"><kie:width>50</kie:width><kie:width>100</kie:width><kie:width>100</kie:width><kie:width>100</kie:width></kie:ComponentWidths></kie:ComponentsWidthsExtension></di:extension><dmndi:DMNShape id="dmnshape-drg-_E6E8DE52-8B8C-4FAF-B928-3AEC1C498BA0" dmnElementRef="_E6E8DE52-8B8C-4FAF-B928-3AEC1C498BA0" isCollapsed="false"><dmndi:DMNStyle><dmndi:FillColor red="255" green="255" blue="255"/><dmndi:StrokeColor red="0" green="0" blue="0"/><dmndi:FontColor red="0" green="0" blue="0"/></dmndi:DMNStyle><dc:Bounds x="395" y="136" width="100" height="50"/><dmndi:DMNLabel/></dmndi:DMNShape><dmndi:DMNShape id="dmnshape-drg-_B600347F-F3F0-4DEC-AFB3-F269D31962B8" dmnElementRef="_B600347F-F3F0-4DEC-AFB3-F269D31962B8" isCollapsed="false"><dmndi:DMNStyle><dmndi:FillColor red="255" green="255" blue="255"/><dmndi:StrokeColor red="0" green="0" blue="0"/><dmndi:FontColor red="0" green="0" blue="0"/></dmndi:DMNStyle><dc:Bounds x="435" y="319" width="100" height="50"/><dmndi:DMNLabel/></dmndi:DMNShape><dmndi:DMNEdge id="dmnedge-drg-_B2D8CFE3-FE64-48A7-AD82-457572D9DB92" dmnElementRef="_B2D8CFE3-FE64-48A7-AD82-457572D9DB92"><di:waypoint x="485" y="344"/><di:waypoint x="445" y="186"/></dmndi:DMNEdge></dmndi:DMNDiagram></dmndi:DMNDI></dmn:definitions>'
        }
      ]
    ])
  });

  document.getElementById("undo").addEventListener("click", () => {
    editor.undo();
  });

  document.getElementById("redo").addEventListener("click", () => {
    editor.redo();
  });

  document.getElementById("download").addEventListener("click", () => {
    editor.getContent().then(content => {
      const elem = window.document.createElement("a");
      elem.href = "data:text/plain;charset=utf-8," + encodeURIComponent(content);
      elem.download = "model.dmn";
      document.body.appendChild(elem);
      elem.click();
      document.body.removeChild(elem);
      editor.stateControl.setSavedCommand();
    });
  });

  document.getElementById("downloadSvg").addEventListener("click", () => {
    editor.getPreview().then(svgContent => {
      const elem = window.document.createElement("a");
      elem.href = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svgContent);
      elem.download = "model.svg";
      document.body.appendChild(elem);
      elem.click();
      document.body.removeChild(elem);
    });
  });

  editor.stateControl.subscribe(isDirty => {
    if (isDirty) {
      document.getElementById("unsavedChanges").classList.remove("hidden");
    } else {
      document.getElementById("unsavedChanges").classList.add("hidden");
    }
  });
</script>
</body>

</html>
